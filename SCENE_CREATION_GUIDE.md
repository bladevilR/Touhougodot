# åœºæ™¯åˆ›å»ºæŒ‡å— (Scene Creation Guide)

æœ¬æŒ‡å—æä¾›äº†åœ¨ Godot ç¼–è¾‘å™¨ä¸­åˆ›å»ºæ¸¸æˆåœºæ™¯çš„è¯¦ç»†æ­¥éª¤ã€‚

## ğŸ“‹ ç›®å½•ç»“æ„

æ‰€æœ‰åœºæ™¯æ–‡ä»¶åº”æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š

```
scenes/
â”œâ”€â”€ overworld/              # ä¸»ä¸–ç•Œåœºæ™¯ï¼ˆRPG éƒ¨åˆ†ï¼‰
â”‚   â”œâ”€â”€ town/              # åŸé•‡
â”‚   â”‚   â”œâ”€â”€ Town.tscn      # åŸé•‡åœºæ™¯æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ Town.gd        # åŸé•‡é€»è¾‘è„šæœ¬ âœ… å·²åˆ›å»º
â”‚   â”œâ”€â”€ farm/              # å†œåœº
â”‚   â”‚   â”œâ”€â”€ Farm.tscn      # å†œï¿½ï¿½åœºæ™¯æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ Farm.gd        # å†œåœºé€»è¾‘è„šæœ¬ âœ… å·²åˆ›å»º
â”‚   â””â”€â”€ dungeon_entrance/  # åœ°ä¸‹åŸå…¥å£
â”‚       â”œâ”€â”€ DungeonEntrance.tscn
â”‚       â””â”€â”€ DungeonEntrance.gd âœ… å·²åˆ›å»º
â””â”€â”€ combat/                # æˆ˜æ–—åœºæ™¯ï¼ˆRoguelike éƒ¨åˆ†ï¼‰
    â””â”€â”€ CombatArena.tscn   # ä» world.tscn æ”¹é€ 
```

---

## ğŸ™ï¸ åœºæ™¯ 1: Town.tscnï¼ˆåŸé•‡ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `scenes/overworld/town/Town.tscn`
- **è„šæœ¬**: `scenes/overworld/town/Town.gd` âœ…
- **åœºæ™¯ç±»å‹**: Node2D
- **ç”¨é€”**: æ¸¸æˆä¸»è¦çš„ä¸»ä¸–ç•Œåœºæ™¯ï¼ŒåŒ…å« NPCã€å•†åº—ã€ä»»åŠ¡å‘å¸ƒè€…

### åˆ›å»ºæ­¥éª¤

#### 1. åˆ›å»ºæ ¹èŠ‚ç‚¹
1. åœ¨ Godot ç¼–è¾‘å™¨ä¸­ï¼Œç‚¹å‡» **Scene â†’ New Scene**
2. é€‰æ‹© **Other Node**ï¼Œæœç´¢å¹¶é€‰æ‹© `Node2D`
3. å°†æ ¹èŠ‚ç‚¹é‡å‘½åä¸º `Town`
4. é™„åŠ è„šæœ¬ `scenes/overworld/town/Town.gd`

#### 2. æ·»åŠ åœ°å›¾ (TileMap)
1. å³é”®ç‚¹å‡» `Town` â†’ **Add Child Node**
2. æœç´¢å¹¶æ·»åŠ  `TileMap`
3. é…ç½® TileMapï¼š
   - è®¾ç½® TileSetï¼ˆå¯ä»¥ä½¿ç”¨ç°æœ‰çš„åœ°å›¾èµ„æºï¼‰
   - ç»˜åˆ¶åœ°é¢ã€å»ºç­‘ã€è£…é¥°ç­‰
   - å»ºè®®å°ºå¯¸ï¼šæ ¹æ®éœ€è¦ï¼Œæ¨èè‡³å°‘ 50x50 æ ¼

#### 3. æ·»åŠ ç©å®¶
1. å³é”®ç‚¹å‡» `Town` â†’ **Add Child Node**
2. é€‰æ‹© **Instantiate Child Scene**
3. é€‰æ‹© `Player.tscn`ï¼ˆåº”è¯¥åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
4. è®¾ç½®ç©å®¶åˆå§‹ä½ç½®ï¼ˆä¾‹å¦‚ï¼šåŸé•‡ä¸­å¿ƒï¼‰

#### 4. æ·»åŠ ç›¸æœº
- ç©å®¶åœºæ™¯åº”è¯¥å·²ç»åŒ…å« Camera2D
- å¦‚æœæ²¡æœ‰ï¼Œåœ¨ Player ä¸‹æ·»åŠ  `Camera2D` èŠ‚ç‚¹
- å‹¾é€‰ `Enabled` å’Œ `Current`

#### 5. æ·»åŠ  NPCï¼ˆç¤ºä¾‹ï¼‰
1. åˆ›å»ºä¸€ä¸ª `CharacterBody2D` æˆ– `Area2D` èŠ‚ç‚¹ä½œä¸º NPC
2. æ·»åŠ  `Sprite2D` å’Œ `CollisionShape2D`
3. å°† NPC æ·»åŠ åˆ°ç»„ `npc`ï¼ˆåœ¨ Inspector â†’ Node â†’ Groupsï¼‰
4. ï¼ˆå¯é€‰ï¼‰åˆ›å»º NPC è„šæœ¬ï¼Œæ·»åŠ  `interacted` ä¿¡å·

#### 6. æ·»åŠ å•†åº—ï¼ˆç¤ºä¾‹ï¼‰
1. åˆ›å»º `Area2D` èŠ‚ç‚¹ä½œä¸ºå•†åº—
2. æ·»åŠ  `Sprite2D`ï¼ˆå•†åº—å›¾æ ‡ï¼‰å’Œ `CollisionShape2D`
3. å°†å•†åº—æ·»åŠ åˆ°ç»„ `shop`
4. ï¼ˆå¯é€‰ï¼‰æ·»åŠ è„šæœ¬ï¼Œå®ç° `shop_opened` ä¿¡å·

#### 7. æ·»åŠ ä¼ é€ç‚¹
åˆ›å»ºä¼ é€åˆ°å…¶ä»–åœºæ™¯çš„ä¼ é€ç‚¹ï¼š

**ä¼ é€åˆ°å†œåœºï¼š**
1. æ·»åŠ  `Area2D` èŠ‚ç‚¹ï¼Œå‘½åä¸º `ToFarm`
2. æ·»åŠ ç¢°æ’å½¢çŠ¶
3. è¿æ¥ä¿¡å· `body_entered`ï¼Œè°ƒç”¨è„šæœ¬ï¼š
```gdscript
func _on_to_farm_body_entered(body):
    if body.is_in_group("player"):
        get_parent().go_to_farm()
```

**ä¼ é€åˆ°åœ°ä¸‹åŸå…¥å£ï¼š**
- åŒæ ·æ–¹å¼åˆ›å»º `ToDungeonEntrance` ä¼ é€ç‚¹

#### 8. ä¿å­˜åœºæ™¯
- **Ctrl + S** ä¿å­˜åœºæ™¯ä¸º `scenes/overworld/town/Town.tscn`

---

## ğŸŒ¾ åœºæ™¯ 2: Farm.tscnï¼ˆå†œåœºï¼‰

### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `scenes/overworld/farm/Farm.tscn`
- **è„šæœ¬**: `scenes/overworld/farm/Farm.gd` âœ…
- **åœºæ™¯ç±»å‹**: Node2D
- **ç”¨é€”**: ç©å®¶çš„å†œåœºï¼Œç§æ¤ã€é¥²å…»ã€å»ºé€ 

### åˆ›å»ºæ­¥éª¤

#### 1. åˆ›å»ºæ ¹èŠ‚ç‚¹
1. æ–°å»ºåœºæ™¯ï¼Œé€‰æ‹© `Node2D`
2. é‡å‘½åä¸º `Farm`
3. é™„åŠ è„šæœ¬ `scenes/overworld/farm/Farm.gd`

#### 2. æ·»åŠ åœ°å›¾
- æ·»åŠ  `TileMap`
- ç»˜åˆ¶å†œåœºåœ°å›¾ï¼ˆå†œç”°ã€è‰åœ°ã€å›´æ ç­‰ï¼‰

#### 3. æ·»åŠ ç©å®¶
- å®ä¾‹åŒ– `Player.tscn`
- è®¾ç½®ç©å®¶å‡ºç”Ÿç‚¹ï¼ˆå†œåœºå…¥å£ï¼‰

#### 4. æ·»åŠ å†œç”°ï¼ˆFarmPlotï¼‰
1. åˆ›å»º `Area2D` èŠ‚ç‚¹ï¼Œå‘½åä¸º `FarmPlot1`
2. æ·»åŠ  `Sprite2D`ï¼ˆå†œç”°å›¾æ ‡ï¼‰å’Œ `CollisionShape2D`
3. å°†å†œç”°æ·»åŠ åˆ°ç»„ `farm_plot`
4. é‡å¤æ­¤æ­¥éª¤åˆ›å»ºå¤šä¸ªå†œç”°

#### 5. æ·»åŠ åŠ¨ç‰©ï¼ˆå¯é€‰ï¼‰
1. åˆ›å»º `CharacterBody2D` æˆ– `Area2D` èŠ‚ç‚¹
2. æ·»åŠ ç²¾çµå’Œç¢°æ’
3. æ·»åŠ åˆ°ç»„ `animal`

#### 6. æ·»åŠ ä¼ é€ç‚¹è¿”å›åŸé•‡
- åˆ›å»º `Area2D` èŠ‚ç‚¹ `ToTown`
- è¿æ¥ `body_entered` ä¿¡å·è°ƒç”¨ `return_to_town()`

#### 7. ä¿å­˜åœºæ™¯
- ä¿å­˜ä¸º `scenes/overworld/farm/Farm.tscn`

---

## âš”ï¸ åœºæ™¯ 3: DungeonEntrance.tscnï¼ˆåœ°ä¸‹åŸå…¥å£ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `scenes/overworld/dungeon_entrance/DungeonEntrance.tscn`
- **è„šæœ¬**: `scenes/overworld/dungeon_entrance/DungeonEntrance.gd` âœ…
- **åœºæ™¯ç±»å‹**: Node2D
- **ç”¨é€”**: é€‰æ‹©åœ°ä¸‹åŸéš¾åº¦å¹¶è¿›å…¥æˆ˜æ–—

### åˆ›å»ºæ­¥éª¤

#### 1. åˆ›å»ºæ ¹èŠ‚ç‚¹
1. æ–°å»ºåœºæ™¯ï¼Œé€‰æ‹© `Node2D`
2. é‡å‘½åä¸º `DungeonEntrance`
3. é™„åŠ è„šæœ¬ `scenes/overworld/dungeon_entrance/DungeonEntrance.gd`

#### 2. æ·»åŠ åœ°å›¾
- æ·»åŠ  `TileMap`
- ç»˜åˆ¶åœ°ä¸‹åŸå…¥å£åœ°å›¾ï¼ˆç¥ç§˜çš„ä¼ é€é—¨åŒºåŸŸï¼‰

#### 3. æ·»åŠ ç©å®¶
- å®ä¾‹åŒ– `Player.tscn`

#### 4. æ·»åŠ éš¾åº¦é€‰æ‹© UI
1. æ·»åŠ  `CanvasLayer` èŠ‚ç‚¹
2. åœ¨å…¶ä¸‹æ·»åŠ  `Control` èŠ‚ç‚¹ï¼Œå‘½åä¸º `DifficultyPanel`
3. æ·»åŠ å­èŠ‚ç‚¹ï¼š
   - `Panel`ï¼ˆèƒŒæ™¯ï¼‰
   - `VBoxContainer`ï¼ˆå¸ƒå±€å®¹å™¨ï¼‰
   - åœ¨ VBoxContainer ä¸­æ·»åŠ å¤šä¸ª `Button`ï¼š
     - "ç®€å•"ã€"æ™®é€š"ã€"å›°éš¾"ã€"åœ°ç‹±"
4. è¿æ¥æŒ‰é’®ä¿¡å·åˆ°è„šæœ¬çš„ `select_difficulty()` å’Œ `enter_dungeon()`

#### 5. æ·»åŠ ä¼ é€é—¨ï¼ˆå¯è§†åŒ–å…ƒç´ ï¼‰
- æ·»åŠ  `Sprite2D` æˆ– `AnimatedSprite2D` ä½œä¸ºä¼ é€é—¨è§†è§‰æ•ˆæœ
- ï¼ˆå¯é€‰ï¼‰æ·»åŠ ï¿½ï¿½ï¿½å­æ•ˆæœ

#### 6. æ·»åŠ è¿”å›åŸé•‡æŒ‰é’®/ä¼ é€ç‚¹
- åœ¨ UI ä¸­æ·»åŠ "è¿”å›"æŒ‰é’®
- æˆ–åˆ›å»º Area2D ä¼ é€ç‚¹

#### 7. ä¿å­˜åœºæ™¯
- ä¿å­˜ä¸º `scenes/overworld/dungeon_entrance/DungeonEntrance.tscn`

---

## âš”ï¸ åœºæ™¯ 4: CombatArena.tscnï¼ˆæˆ˜æ–—åœºæ™¯ï¼‰

### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `scenes/combat/CombatArena.tscn`
- **è„šæœ¬**: ä» `world.gd` æ”¹é€ è€Œæ¥
- **åœºæ™¯ç±»å‹**: Node2D
- **ç”¨é€”**: Roguelike æˆ˜æ–—åœºæ™¯

### åˆ›å»ºæ­¥éª¤

#### æ–¹æ¡ˆ 1: ä»ç°æœ‰ world.tscn æ”¹é€ 
1. å¤åˆ¶ `world.tscn` åˆ° `scenes/combat/CombatArena.tscn`
2. é‡å‘½åæ ¹èŠ‚ç‚¹ä¸º `CombatArena`
3. ç§»é™¤ä¸»ä¸–ç•Œç›¸å…³å…ƒç´ ï¼š
   - ç§»é™¤ NPC
   - ç§»é™¤å•†åº—
   - ç§»é™¤éæˆ˜æ–—ç›¸å…³çš„ UI
4. ä¿ç•™æˆ˜æ–—æ ¸å¿ƒç³»ç»Ÿï¼š
   - MapSystemï¼ˆåœ°å›¾æ¸²æŸ“ï¼‰
   - Playerï¼ˆç©å®¶ï¼‰
   - EnemySpawnerï¼ˆæ•Œäººç”Ÿæˆï¼‰
   - RoomManagerï¼ˆæˆ¿é—´ç®¡ç†ï¼‰
   - ExperienceManagerï¼ˆç»éªŒç®¡ç†ï¼‰
5. ä¿®æ”¹è„šæœ¬é€»è¾‘ï¼š
   - æ·»åŠ æˆ˜æ–—ç»“æŸæ£€æµ‹
   - æ·»åŠ è¿”å›ä¸»ä¸–ç•Œçš„é€»è¾‘
   - è°ƒç”¨ `SceneManager.exit_combat(victory)`

#### æ–¹æ¡ˆ 2: åˆ›å»ºæ–°åœºæ™¯
- å¦‚æœ world.tscn è¿‡äºå¤æ‚ï¼Œå¯ä»¥åˆ›å»ºæ–°åœºæ™¯
- å‚è€ƒ world.tscn çš„ç»“æ„ï¼Œåªä¿ç•™æˆ˜æ–—å¿…éœ€éƒ¨åˆ†

#### ä¿å­˜åœºæ™¯
- ä¿å­˜ä¸º `scenes/combat/CombatArena.tscn`

---

## ğŸ”— åœºæ™¯ä¹‹é—´çš„è¿æ¥

### 1. æ›´æ–° SceneManager åœºæ™¯è·¯å¾„
ç¡®ä¿ `scripts/core/SceneManager.gd` ä¸­çš„è·¯å¾„æ­£ç¡®ï¼š

```gdscript
const SCENES = {
    "menu": "res://TitleScreen.tscn",
    "town": "res://scenes/overworld/town/Town.tscn",
    "farm": "res://scenes/overworld/farm/Farm.tscn",
    "dungeon_entrance": "res://scenes/overworld/dungeon_entrance/DungeonEntrance.tscn",
    "combat": "res://scenes/combat/CombatArena.tscn"
}
```

### 2. æ›´æ–° TitleScreen.gd
åœ¨ `TitleScreen.gd` ä¸­ï¼Œå°†ä¸´æ—¶çš„ LoadingScreen æ›¿æ¢ä¸ºåŸé•‡ï¼š

```gdscript
## æ–°æ¸¸æˆ
func _on_new_game():
    # ...
    # SceneManager.change_scene("town")  # å–æ¶ˆæ³¨é‡Š
    # _transition_to_scene("res://LoadingScreen.tscn")  # åˆ é™¤è¿™è¡Œ
```

---

## âœ… åœºæ™¯åˆ›å»ºæ£€æŸ¥æ¸…å•

### Town.tscn
- [ ] åˆ›å»º Node2D æ ¹èŠ‚ç‚¹
- [ ] é™„åŠ  Town.gd è„šæœ¬
- [ ] æ·»åŠ  TileMap åœ°å›¾
- [ ] æ·»åŠ  Player å®ä¾‹
- [ ] æ·»åŠ è‡³å°‘ 1 ä¸ª NPCï¼ˆç»„ï¼š`npc`ï¼‰
- [ ] æ·»åŠ è‡³å°‘ 1 ä¸ªå•†åº—ï¼ˆç»„ï¼š`shop`ï¼‰
- [ ] æ·»åŠ ä¼ é€ç‚¹åˆ°å†œåœº
- [ ] æ·»åŠ ä¼ é€ç‚¹åˆ°åœ°ä¸‹åŸå…¥å£
- [ ] ä¿å­˜åœºæ™¯

### Farm.tscn
- [ ] åˆ›å»º Node2D æ ¹èŠ‚ç‚¹
- [ ] é™„åŠ  Farm.gd è„šæœ¬
- [ ] æ·»åŠ  TileMap åœ°å›¾
- [ ] æ·»åŠ  Player å®ä¾‹
- [ ] æ·»åŠ å†œç”°ï¼ˆç»„ï¼š`farm_plot`ï¼‰
- [ ] æ·»åŠ è¿”å›åŸé•‡ä¼ é€ç‚¹
- [ ] ä¿å­˜åœºæ™¯

### DungeonEntrance.tscn
- [ ] åˆ›å»º Node2D æ ¹èŠ‚ç‚¹
- [ ] é™„åŠ  DungeonEntrance.gd è„šæœ¬
- [ ] æ·»åŠ  TileMap åœ°å›¾
- [ ] æ·»åŠ  Player å®ä¾‹
- [ ] æ·»åŠ éš¾åº¦é€‰æ‹© UI
- [ ] è¿æ¥æŒ‰é’®ä¿¡å·
- [ ] æ·»åŠ è¿”å›åŸé•‡ä¼ é€ç‚¹
- [ ] ä¿å­˜åœºæ™¯

### CombatArena.tscn
- [ ] ä» world.tscn å¤åˆ¶æˆ–æ–°å»º
- [ ] é‡å‘½åä¸º CombatArena
- [ ] ç§»é™¤éæˆ˜æ–—å…ƒç´ 
- [ ] ä¿ç•™æˆ˜æ–—æ ¸å¿ƒç³»ç»Ÿ
- [ ] æ·»åŠ æˆ˜æ–—ç»“æŸé€»è¾‘
- [ ] ä¿å­˜åœºæ™¯

---

## ğŸ® æµ‹è¯•æµç¨‹

åˆ›å»ºå®Œåœºæ™¯åï¼Œæµ‹è¯•ä»¥ä¸‹æµç¨‹ï¼š

1. **å¯åŠ¨æ¸¸æˆ** â†’ TitleScreen
2. **æ–°æ¸¸æˆ** â†’ Townï¼ˆåŸé•‡ï¼‰
3. **åœ¨åŸé•‡ä¸­èµ°åŠ¨ã€ä¸ NPC äº¤äº’**
4. **ä¼ é€åˆ°å†œåœº** â†’ Farm
5. **è¿”å›åŸé•‡** â†’ Town
6. **ä¼ é€åˆ°åœ°ä¸‹åŸå…¥å£** â†’ DungeonEntrance
7. **é€‰æ‹©éš¾åº¦å¹¶è¿›å…¥æˆ˜æ–—** â†’ CombatArena
8. **æˆ˜æ–—ç»“æŸåè¿”å›** â†’ Town
9. **ä¿å­˜æ¸¸æˆ**ï¼ˆF5ï¼‰
10. **é‡å¯æ¸¸æˆï¼Œç»§ç»­æ¸¸æˆ** â†’ æ¢å¤åˆ°åŸé•‡

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Player åœºæ™¯**
   - ç¡®ä¿ Player.tscn å·²ç»é…ç½®å¥½ï¼ˆCamera2Dã€Sprite2Dã€CollisionShape2D ç­‰ï¼‰
   - ç©å®¶åº”è¯¥æœ‰ `player` ç»„æ ‡ç­¾

2. **ç¢°æ’å±‚é…ç½®**
   - ç©å®¶ï¼šLayer 1
   - å¢™å£/åœ°å›¾ï¼šLayer 2
   - NPC/å•†åº—ï¼šLayer 3ï¼ˆæˆ–ä½¿ç”¨ Area2D ä¸å‚ä¸ç‰©ç†ç¢°æ’ï¼‰

3. **åœºæ™¯åˆ‡æ¢**
   - å§‹ç»ˆä½¿ç”¨ `SceneManager.change_scene()` è¿›è¡Œåœºæ™¯åˆ‡æ¢
   - ä¸è¦ç›´æ¥ä½¿ç”¨ `get_tree().change_scene_to_file()`

4. **è°ƒè¯•**
   - åœ¨æ¯ä¸ªåœºæ™¯è„šæœ¬çš„ `_ready()` ä¸­æ‰“å°æ—¥å¿—ï¼Œç¡®è®¤åœºæ™¯æ­£ç¡®åŠ è½½
   - ä½¿ç”¨ `print("[SceneName] ä¿¡æ¯")` æ ¼å¼åŒ–æ—¥å¿—

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-04
**ä½œè€…**: Claude Code
