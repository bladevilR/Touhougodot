# UI布局优化 - 2025-12-14

## 调整的内容

### ✅ 1. HP和经验条 - 移到左下角
**原因**: 头像在左上角时空间不够

**调整**:
- **HPPanel**: 从左上角(20, 15)移到左下角(20, 940)
- **ExpPanel**: 从(20, 60)移到(20, 985)
- **LevelLabel**: 移到(20, 1030) - HP/EXP下方
- **CoinsLabel**: 移到(130, 1030) - 等级标签右侧

**文件**: `GameUI.tscn:10-104`

---

### ✅ 2. 技能冷却UI - 移到左中间
**原因**: 更好的视觉布局，技能信息在屏幕中央左侧更易看到

**调整**:
- 从左下角(`PRESET_BOTTOM_LEFT`, position -80)
- 改为左中间(`PRESET_CENTER_LEFT`, position -30)

**文件**: `GameUI.gd:318-325`

---

### ✅ 3. 河童NPC - 缩小模型
**原因**: 模型太大，占据过多屏幕空间

**调整**:
- **scale**: 从0.1改为0.05（缩小50%）
- **offset**: 从(0, -400)改为(0, -200)（降低高度）

**文件**: `NitoriNPC.tscn:13-16`

**效果**: 河童现在是合理的NPC大小，不会遮挡视野

---

### ✅ 4. P点（经验宝石） - 缩小尺寸
**原因**: P点太大，不利于视觉清晰度

**调整**:
- **scale**: 从0.3改为0.15（缩小50%）

**文件**: `ExperienceGem.tscn:14-16`

**效果**: P点现在是适中大小，拾取更精准

---

### ✅ 5. 对话框系统 - 全面优化
**原因**: 对话框位置不合理，立绘太大占满屏幕

**调整**:

#### 对话框容器
- **position**: 从(0, -250)改为(0, -300) - 向上移动50像素
- **size**: 从250高度改为280高度 - 增加空间

#### 立绘容器
- **position**: 从(50, 20)改为(50, 30)
- **size**: 从300x220改为200x240 - 缩小立绘显示
- 立绘纹理同步缩小到200x240

#### 文字容器
- **position**: 从(380, 20)改为(280, 30) - 向左移动适应更小的立绘
- **size**: 从850宽改为1000宽 - 增加文字空间

#### 关闭按钮
- **position**: 从(1050, 200)改为(1100, 230) - 调整到新布局

**文件**: `DialoguePortrait.gd:63-123`

**效果**:
- 对话框在屏幕底部清晰可见
- 立绘不再占满屏幕，大小适中
- 文字区域更宽，阅读更舒适

---

## 视觉效果对比

### 修改前的问题
❌ HP/EXP在左上角，头像空间不够
❌ 技能冷却在左下角，与HP重叠
❌ 河童NPC巨大（scale 0.1）
❌ P点很大（scale 0.3）
❌ 对话框几乎在屏幕外
❌ 立绘占满整个屏幕（300x220且未限制）

### 修改后的效果
✅ HP/EXP在左下角，整洁布局
✅ 技能冷却在左中间，清晰可见
✅ 河童NPC合理大小（scale 0.05）
✅ P点适中（scale 0.15）
✅ 对话框在屏幕底部300像素处
✅ 立绘缩小到200x240，不遮挡游戏内容

---

## UI布局参考图

```
屏幕布局 (1920x1080):

┌─────────────────────────────────────────────────┐
│  [房间信息]       [DPS统计]  [房间地图]       │  ← 顶部
│  [转流/金币]                                     │
│                                                  │
│                                                  │
│  [技能冷却]                                      │  ← 左中间
│   [SPACE]                                        │
│                                                  │
│                                                  │
│  [HP条]                                          │  ← 左下角
│  [经验条]                                        │
│  [Lv.X] [金币: X]                                │
└─────────────────────────────────────────────────┘
         [对话框 - 底部300像素处]
  [立绘200x240] [角色名 + 对话文字]
```

---

## 修改的文件清单

1. **GameUI.tscn** - HP/EXP/等级/金币位置
2. **GameUI.gd** - 技能冷却UI位置
3. **NitoriNPC.tscn** - 河童模型缩放
4. **ExperienceGem.tscn** - P点缩放
5. **DialoguePortrait.gd** - 对话框布局全面优化

---

## 测试要点

### 启动游戏后检查

1. **左下角**
   - [ ] HP条可见
   - [ ] 经验条在HP下方
   - [ ] 等级和金币在最下方

2. **左中间**
   - [ ] 技能冷却显示（按空格测试）
   - [ ] 不与左下角UI重叠

3. **河童NPC**
   - [ ] 进入商店房间
   - [ ] 河童大小适中，不遮挡视野

4. **P点**
   - [ ] 击杀敌人
   - [ ] P点大小适中，容易拾取

5. **对话框**（游戏开始0.5秒后）
   - [ ] 对话框在屏幕底部可见
   - [ ] 立绘大小合理（200x240）
   - [ ] 文字清晰可读
   - [ ] 按空格或E可关闭

---

## 技术细节

### 锚点使用
- `PRESET_BOTTOM_WIDE` - 对话框（宽度自适应屏幕）
- `PRESET_CENTER_LEFT` - 技能冷却（左中间）
- 绝对坐标 - HP/EXP（精确控制位置）

### 缩放计算
- **河童**: 0.1 → 0.05 = 50%缩小
- **P点**: 0.3 → 0.15 = 50%缩小
- **立绘**: 300x220 → 200x240 = 33%缩小宽度，9%增加高度

### 层级管理
- 所有UI元素在CanvasLayer上（z-index由Godot自动管理）
- 对话框使用半透明背景（Color 0,0,0,0.7）确保可见性

---

## 未来优化建议

### 可考虑的改进
1. **响应式布局** - 根据屏幕分辨率自动调整UI大小
2. **UI缩放选项** - 在设置菜单中添加UI缩放滑块
3. **立绘动画** - 对话框出现时添加淡入效果
4. **UI主题** - 允许玩家选择不同的UI风格

### 性能考虑
- 当前所有UI都是动态创建的（GameUI.gd中的_create_*函数）
- 如果需要优化，可以考虑将一些固定UI移到.tscn场景文件中
- 对话框使用了半透明背景，在低端设备上可能需要优化

---

*生成时间: 2025-12-14*
*优化项目: 5个主要UI元素*
*修改文件: 5个*
