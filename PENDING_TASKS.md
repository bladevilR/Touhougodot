# 待完成任务清单

## 🔴 紧急修复任务 (2025-12-19 新增)

### 1. 辉夜 Boss 模型显示问题
**优先级**: 最高 (Critical)
- **问题**: 尽管已尝试修复，辉夜 Boss 在游戏中仍然没有显示出模型（看起来不可见或透明）。
- **现状**: 已尝试强制设置透明度为 1.0，并使用了智能缩放。
- **下一步**: 需要深入排查 `Enemy.gd` 中的 `setup_as_boss` 或 `_physics_process`，确认是否还有其他逻辑（如残留的 Shader 或材质设置）导致其不可见。

### 2. 毛玉 (Kedama) 大小调整
**优先级**: 中
- **问题**: 目前放大的毛玉 (scale 0.04) 还是有点太大，视觉上不协调。
- **需求**: 稍微缩小一点，建议尝试 `scale 0.035` 或 `0.03`，找到最佳平衡点。
- **相关文件**: `EnemyData.gd`

### 3. 妹红动态影子系统
**优先级**: 中
- **问题**: 目前妹红的影子是完全静态的椭圆，这虽然符合物理（不随身体翻转），但在进行大幅度动作（如飞踢、跳跃）时显得生硬。
- **需求**: 实现一个稍微智能一点的影子系统：
    - 影子不需要完全随身体翻转（保持光源一致性）。
    - 但影子形状应该随动作变化（例如：站立时是圆的，飞踢时稍微拉长或变化）。
    - **具体建议**: 至少准备两种不同的影子贴图或缩放状态，在不同动画（Stand vs Attack/Jump）之间交替切换。
- **相关文件**: `Player.gd`

---

## 🟢 已完成的修复 (2025-12-19)

### ✅ 1. 辉夜 Boss 机制重构
- **文件**: `Enemy.gd`, `EnemySpawner.gd`
- **修复**: 修复了 Boss 初始化逻辑，现在使用 `setup_as_boss` 确保正确加载 Boss 配置和攻击模式。
- **修复**: 修复了“只移动不攻击”的 AI 问题。
- **修复**: 修复了“发光圆球”问题（移除了错误的 ADD 混合模式）。

### ✅ 2. 纯净 Boss 房
- **文件**: `RoomManager.gd`
- **实现**: 进入 Boss 房时强制清理所有杂兵 (`queue_free`)，并重置刷怪器，确保 1v1 决斗环境。

### ✅ 3. 妹红右键技能重做
- **文件**: `WeaponSystem.gd`
- **实现**: 重做了右键重击逻辑：
    - **范围**: 扩大判定范围至 250px 扇形。
    - **效果**: 对范围内所有敌人造成击退和伤害。
    - **处刑**: 对最近的敌人造成额外的超强击飞 + 12圈旋转特效。

### ✅ 4. 系统稳定性修复
- **文件**: `GameUI.gd`, `RoomManager.gd`, `DialoguePortrait.gd`, `RoomMapCanvas.gd`
- **修复**: 彻底解决了导致游戏崩溃的循环依赖 (`Parse error` / `Nonexistent function 'new'`) 问题。通过移除全局 `class_name` 并使用动态加载 (`load()`) 解耦了 UI 系统。

---

## 🟡 历史遗留任务

### 1. 影子贴合问题
**优先级**: 低 (已部分优化)
- **问题**: 妹红的影子位置仍需微调。

### 2. 商店系统完善
**优先级**: 中
- 商店位置优化（确保必经之路）。
- 对话内容丰富化。

### 3. 胜利界面
**优先级**: 中
- 击败 Boss 后显示结算界面。

---

*最后更新: 2025-12-19*