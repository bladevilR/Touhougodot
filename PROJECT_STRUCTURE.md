# Touhou Phantom - é¡¹ç›®ç»“æ„æ–‡æ¡£

## ğŸ“ æ ¸å¿ƒç›®å½•ç»“æ„

```
touhou-godot/
â”œâ”€â”€ ğŸ“‚ core/                    # ğŸ†• æ ¸å¿ƒç³»ç»Ÿæ¨¡å—ï¼ˆé‡æ„æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ autoloads/              # å…¨å±€è‡ªåŠ¨åŠ è½½å•ä¾‹
â”‚   â”‚   â”œâ”€â”€ ServiceLocator.gd   # æœåŠ¡å®šä½å™¨
â”‚   â”‚   â”œâ”€â”€ ResourceManager.gd  # èµ„æºç®¡ç†å™¨ï¼ˆå¯¹è±¡æ± ï¼‰
â”‚   â”‚   â”œâ”€â”€ SceneManager.gd     # åœºæ™¯ç®¡ç†å™¨ï¼ˆå¸¦è½¬åœºåŠ¨ç”»ï¼‰
â”‚   â”‚   â””â”€â”€ AudioManager.gd     # éŸ³é¢‘ç®¡ç†å™¨
â”‚   â”œâ”€â”€ managers/               # æ¸¸æˆç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ GameplaySystem.gd   # æ¸¸æˆæµç¨‹åè°ƒå™¨
â”‚   â””â”€â”€ README.md               # æ ¸å¿ƒç³»ç»Ÿæ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“‚ entities/                # ğŸ†• å®ä½“ä¸ç»„ä»¶ç³»ç»Ÿï¼ˆé‡æ„æ–°å¢ï¼‰
â”‚   â””â”€â”€ components/             # ç»„ä»¶åº“
â”‚       â”œâ”€â”€ GameComponent.gd    # ç»„ä»¶åŸºç±»
â”‚       â”œâ”€â”€ ShadowComponent.gd  # é˜´å½±ç»„ä»¶
â”‚       â”œâ”€â”€ MovementComponent.gd # ç§»åŠ¨ç»„ä»¶
â”‚       â”œâ”€â”€ StatusEffectComponent.gd # çŠ¶æ€æ•ˆæœç»„ä»¶
â”‚       â”œâ”€â”€ SpriteComponent.gd  # ç²¾çµç»„ä»¶
â”‚       â””â”€â”€ README.md           # ç»„ä»¶ç³»ç»Ÿæ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“‚ scenes/                  # ğŸ†• åœºæ™¯ç³»ç»Ÿï¼ˆï¿½ï¿½æ„æ–°å¢ï¼‰
â”‚   â””â”€â”€ battle/                 # æˆ˜æ–—åœºæ™¯
â”‚       â””â”€â”€ RenderSystem.gd     # æ¸²æŸ“ç³»ç»Ÿï¼ˆå…‰ç…§ã€é˜´å½±ã€é›¾æ•ˆï¼‰
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                   # ğŸ†• æµ‹è¯•åœºæ™¯ç³»ç»Ÿï¼ˆéš”ç¦»æµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ scenes/                 # æµ‹è¯•åœºæ™¯
â”‚   â”‚   â”œâ”€â”€ 3d_model_test/      # 3Dæ¨¡å‹æµ‹è¯•
â”‚   â”‚   â”‚   â”œâ”€â”€ player2_test.tscn
â”‚   â”‚   â”‚   â””â”€â”€ test_controller.gd
â”‚   â”‚   â”œâ”€â”€ shader_test/        # Shaderæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ ui_test/            # UIæµ‹è¯•
â”‚   â”‚   â””â”€â”€ performance_test/   # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ models/                 # æµ‹è¯•ç”¨æ¨¡å‹
â”‚   â”œâ”€â”€ shaders/                # å®éªŒæ€§Shader
â”‚   â”‚   â””â”€â”€ toon_shader.gdshader
â”‚   â”œâ”€â”€ SceneLauncher.gd        # åœºæ™¯å¯åŠ¨å™¨
â”‚   â”œâ”€â”€ README.md               # æµ‹è¯•ç³»ç»Ÿè¯´æ˜
â”‚   â””â”€â”€ SCENE_SWITCHING_GUIDE.md # åœºæ™¯åˆ‡æ¢æŒ‡å—
â”‚
â”œâ”€â”€ ğŸ“‚ assets/                  # æ¸¸æˆèµ„æº
â”‚   â”œâ”€â”€ characters/             # è§’è‰²èµ„æº
â”‚   â”‚   â”œâ”€â”€ *.fbx               # 3Dæ¨¡å‹æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ *.png               # 2Dè§’è‰²å›¾
â”‚   â”‚   â””â”€â”€ Mokou_Skin.tscn     # è§’è‰²çš®è‚¤
â”‚   â”œâ”€â”€ map/                    # åœ°å›¾èµ„æº
â”‚   â”œâ”€â”€ weapons/                # æ­¦å™¨èµ„æº
â”‚   â”œâ”€â”€ ui/                     # UIèµ„æº
â”‚   â””â”€â”€ grass2.png              # è‰åœ°çº¹ç†
â”‚
â”œâ”€â”€ ğŸ“œ ä¸»è¦åœºæ™¯æ–‡ä»¶ (æ ¹ç›®å½•)
â”‚   â”œâ”€â”€ world.tscn              # â­ ç«¹æ—æˆ˜æ–—å…³å¡ï¼ˆä¸»å…³å¡ï¼‰
â”‚   â”œâ”€â”€ TownWorld.tscn          # å°é•‡åœºæ™¯
â”‚   â”œâ”€â”€ MainMenu.tscn           # ä¸»èœå•
â”‚   â”œâ”€â”€ Player.tscn             # ç©å®¶åœºæ™¯
â”‚   â”œâ”€â”€ Player3DVisuals.tscn    # 3Dè§†è§‰æ•ˆæœ
â”‚   â”œâ”€â”€ PlayerViewport.tscn     # ç©å®¶è§†å£ï¼ˆç”¨äº2Dä¸­æ˜¾ç¤º3Dï¼‰
â”‚   â”œâ”€â”€ Enemy.tscn              # æ•Œäººåœºæ™¯
â”‚   â”œâ”€â”€ GameUI.tscn             # æ¸¸æˆUI
â”‚   â””â”€â”€ ... (å…¶ä»–åœºæ™¯)
â”‚
â”œâ”€â”€ ğŸ“œ ä¸»è¦è„šæœ¬æ–‡ä»¶ (æ ¹ç›®å½•)
â”‚   â”œâ”€â”€ Player.gd               # ç©å®¶æ§åˆ¶å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ Player3DVisuals.gd      # 3Dæ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ PlayerViewport.gd       # è§†å£æ§åˆ¶
â”‚   â”œâ”€â”€ Enemy.gd                # æ•ŒäººAI
â”‚   â”œâ”€â”€ MapSystem.gd            # åœ°å›¾ç³»ç»Ÿï¼ˆç«¹å­ã€å…‰ç…§ã€é›¾æ•ˆï¼‰
â”‚   â”œâ”€â”€ GameUI.gd               # UIæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ SignalBus.gd            # å…¨å±€ä¿¡å·æ€»çº¿
â”‚   â”œâ”€â”€ GameSettings.gd         # æ¸¸æˆè®¾ç½®
â”‚   â””â”€â”€ ... (å…¶ä»–è„šæœ¬)
â”‚
â”œâ”€â”€ ğŸ“„ project.godot            # Godoté¡¹ç›®é…ç½®
â”œâ”€â”€ ğŸ“„ REFACTORING_SUMMARY.md   # ğŸ†• é‡æ„æ€»ç»“æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ QUICK_REFERENCE.md       # ğŸ†• å¿«é€Ÿå‚è€ƒæŒ‡å—
â””â”€â”€ ğŸ“„ .gitignore               # Gitå¿½ç•¥è§„åˆ™
```

## ğŸ¯ é¡¹ç›®æ¶æ„è¯´æ˜

### äº”å±‚æ¶æ„

```
1ï¸âƒ£ Global Services (å…¨å±€æœåŠ¡å±‚)
   â””â”€â”€ ServiceLocator, ResourceManager, AudioManager, SceneManager
         â†“
2ï¸âƒ£ Scene Management (åœºæ™¯ç®¡ç†å±‚)
   â””â”€â”€ SceneManagerå¤„ç†åœºæ™¯åˆ‡æ¢
         â†“
3ï¸âƒ£ Game Systems (æ¸¸æˆç³»ç»Ÿå±‚)
   â””â”€â”€ GameplaySystem, MapSystem, RenderSystem
         â†“
4ï¸âƒ£ Entity Components (å®ä½“ç»„ä»¶å±‚)
   â””â”€â”€ Player, Enemy, å„ç§GameComponent
         â†“
5ï¸âƒ£ Data Layer (æ•°æ®å±‚)
   â””â”€â”€ SignalBus, GameSettings, èµ„æºæ–‡ä»¶
```

## ğŸ“¦ æ¨¡å—èŒè´£

### æ ¸å¿ƒæ¨¡å— (core/)
- **ServiceLocator**: O(1)æœåŠ¡æŸ¥æ‰¾ï¼Œæ›¿ä»£ä½æ•ˆçš„`get_nodes_in_group()`
- **ResourceManager**: å¯¹è±¡æ± ç®¡ç†ï¼Œå‡å°‘GCå‹åŠ›
- **SceneManager**: ç»Ÿä¸€åœºæ™¯åˆ‡æ¢ï¼Œå¸¦æ·¡å…¥æ·¡å‡ºæ•ˆæœ
- **AudioManager**: éŸ³ä¹/éŸ³æ•ˆç®¡ç†ï¼ŒéŸ³é¢‘æ± 
- **GameplaySystem**: æ¸¸æˆæµç¨‹åè°ƒï¼Œç›‘å¬13ä¸ªå…³é”®äº‹ä»¶

### å®ä½“ç»„ä»¶æ¨¡å— (entities/)
- **GameComponent**: ç»„ä»¶åŸºç±»ï¼Œç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸ
- **ShadowComponent**: ç‹¬ç«‹é˜´å½±ç®¡ç†
- **MovementComponent**: ç§»åŠ¨ã€å†²åˆºã€å‡»é€€
- **StatusEffectComponent**: çŠ¶æ€æ•ˆæœï¼ˆç‡ƒçƒ§ã€å†°å†»ç­‰ï¼‰
- **SpriteComponent**: ç²¾çµæ¸²æŸ“ç®¡ç†

### åœºæ™¯æ¨¡å— (scenes/)
- **RenderSystem**: æ¸²æŸ“ç³»ç»Ÿï¼Œç®¡ç†å…‰ç…§ã€é˜´å½±ã€é›¾æ•ˆ

### æµ‹è¯•æ¨¡å— (tests/)
- **éš”ç¦»çš„æµ‹è¯•ç¯å¢ƒ**ï¼Œé¿å…ç ´åä¸»å…³å¡
- **ç‹¬ç«‹çš„æµ‹è¯•åœºæ™¯**ï¼Œæ–¹ä¾¿å®éªŒæ–°åŠŸèƒ½
- **åœºæ™¯åˆ‡æ¢å·¥å…·**ï¼Œå¿«é€Ÿåˆ‡æ¢å¼€å‘/æµ‹è¯•ç¯å¢ƒ

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### æ­£å¸¸å¼€å‘æµç¨‹
1. ç›´æ¥ä¿®æ”¹ `world.tscn`ï¼ˆç«¹æ—å…³å¡ï¼‰æˆ–ç›¸å…³è„šæœ¬
2. è¿è¡Œæµ‹è¯•
3. æäº¤ï¼š`git commit -m "feat: æ–°åŠŸèƒ½æè¿°"`

### å®éªŒæ€§å¼€å‘æµç¨‹
1. åœ¨ `tests/` ç›®å½•åˆ›å»ºæµ‹è¯•åœºæ™¯
2. å¤åˆ¶éœ€è¦çš„èŠ‚ç‚¹/è„šæœ¬åˆ°æµ‹è¯•åœºæ™¯
3. åœ¨æµ‹è¯•åœºæ™¯ä¸­è‡ªç”±å®éªŒ
4. **ä¸ä¿®æ”¹ä¸»å…³å¡æ–‡ä»¶**
5. æµ‹è¯•æˆåŠŸåï¼Œå°†æ”¹åŠ¨åˆå¹¶å›ä¸»é¡¹ç›®
6. æäº¤ï¼š`git commit -m "test: æµ‹è¯•åŠŸèƒ½æè¿°"`

## âš ï¸ é‡è¦è§„åˆ™

### âœ… ç¨³å®šçš„æ–‡ä»¶ï¼ˆå·²æ¢å¤åˆ°å®Œå–„çŠ¶æ€ï¼‰
- `world.tscn` - ç«¹æ—æˆ˜æ–—å…³å¡
- `Player.gd` - ç©å®¶æ ¸å¿ƒé€»è¾‘
- `GameUI.gd` - æ¸¸æˆUIï¼ˆ350x350å¤§å¤´åƒï¼‰
- `MapSystem.gd` - åœ°å›¾ç³»ç»Ÿï¼ˆç«¹å­é«˜åº¦ï¼š100/180/300ï¼‰
- `PlayerViewport.tscn` - æ‘„åƒæœºé«˜åº¦ï¼ˆY=10ï¼‰
- `Player3DVisuals.gd` - 3Dæ¸²æŸ“

### âŒ ç¦æ­¢æ“ä½œ
- ä¸è¦ä¸ºäº†æµ‹è¯•è€Œä¿®æ”¹ä¸»å…³å¡æ–‡ä»¶
- ä¸è¦ç›´æ¥ä¿®æ”¹æ ¸å¿ƒè„šæœ¬æ¥åšå®éªŒ
- ä¸è¦åœ¨mainåˆ†æ”¯åšå¤§é‡æœªç»éªŒè¯çš„æ”¹åŠ¨

### âœ… æ¨èæ“ä½œ
- æ‰€æœ‰æµ‹è¯•åœ¨ `tests/` ç›®å½•è¿›è¡Œ
- ä½¿ç”¨ `SceneLauncher` å¿«é€Ÿåˆ‡æ¢åœºæ™¯
- ä½¿ç”¨Gitåˆ†æ”¯è¿›è¡Œå¤§å‹å®éªŒ
- å®šæœŸæäº¤ï¼Œä¿æŒå¯å›æ»šçŠ¶æ€

## ğŸ“ å¿«é€Ÿå‘½ä»¤

```bash
# æ¢å¤ä¸»å…³å¡åˆ°ç¨³å®šçŠ¶æ€
git checkout GameUI.gd Player.gd MapSystem.gd PlayerViewport.gd PlayerViewport.tscn Player3DVisuals.gd

# æŸ¥çœ‹å½“å‰æ”¹åŠ¨
git status

# åˆ‡æ¢åˆ°ç«¹æ—å…³å¡
# ä¿®æ”¹ project.godot: run/main_scene="res://world.tscn"

# åˆ‡æ¢åˆ°æµ‹è¯•åœºæ™¯
# ä¿®æ”¹ project.godot: run/main_scene="res://tests/scenes/3d_model_test/player2_test.tscn"
```

## ğŸ® ä¸»è¦åœºæ™¯è¯´æ˜

| åœºæ™¯ | è·¯å¾„ | çŠ¶æ€ | ç”¨é€” |
|-----|------|------|------|
| ç«¹æ—å…³å¡ | `world.tscn` | âœ… ç¨³å®š | ä¸»æˆ˜æ–—å…³å¡ |
| å°é•‡ | `TownWorld.tscn` | âœ… ç¨³å®š | å°é•‡åœºæ™¯ |
| ä¸»èœå• | `MainMenu.tscn` | âœ… ï¿½ï¿½å®š | æ¸¸æˆä¸»èœå• |
| 3Dæµ‹è¯• | `tests/scenes/3d_model_test/player2_test.tscn` | ğŸ§ª æµ‹è¯• | 3Dæ¨¡å‹æµ‹è¯• |

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `REFACTORING_SUMMARY.md` - è¯¦ç»†çš„é‡æ„æŠ¥å‘Š
- `QUICK_REFERENCE.md` - APIå¿«é€Ÿå‚è€ƒ
- `tests/README.md` - æµ‹è¯•ç³»ç»Ÿè¯´æ˜
- `tests/SCENE_SWITCHING_GUIDE.md` - åœºæ™¯åˆ‡æ¢æŒ‡å—
- `core/README.md` - æ ¸å¿ƒç³»ç»Ÿæ–‡æ¡£
- `entities/components/README.md` - ç»„ä»¶ç³»ç»Ÿæ–‡æ¡£
