# 房间系统实装验证清单

## ⚠️ 重要：如何让修改生效

### 方法1：重新加载项目（推荐）
1. 关闭Godot编辑器
2. 重新打开项目
3. 运行游戏

### 方法2：强制重新加载脚本
1. 在Godot编辑器中，点击菜单 `Project` -> `Reload Current Project`
2. 运行游戏

### 方法3：手动重新导入
1. 右键点击修改的脚本文件
2. 选择 `Reimport`
3. 运行游戏

---

## 📝 已修改的文件清单

### 核心系统文件
1. **RoomManager.gd** ✅
   - 添加: `add_to_group("room_manager")`
   - 修改: 完全重构为基于击杀数的系统
   - 新增: 房间网络生成、多门系统、Boss对话

2. **ExperienceManager.gd** ✅
   - 添加: `add_to_group("experience_manager")`
   - 修改: 恢复P点掉落（`spawn_gem`）
   - 新增: 転流货币系统

3. **EnemySpawner.gd** ✅
   - 添加: `add_to_group("enemy_spawner")`
   - 保持: `use_room_system = true`

4. **GameUI.gd** ✅
   - 添加: `add_to_group("ui")`
   - 新增: 転流显示、房间地图、Boss对话UI
   - 修改: 波次改为击杀显示

5. **SignalBus.gd** ✅
   - 新增: `boss_dialogue` 信号
   - 新增: `tenryu_changed` 信号

### 新建文件
6. **EnchantShop.gd** ✨ (新文件)
7. **EnchantShop.tscn** ✨ (新文件)
8. **RoomMapCanvas.gd** ✨ (新文件)
9. **DebugChecker.gd** 🔧 (调试用)

### 场景文件
10. **world.tscn** ✅
    - 添加: DebugChecker节点

---

## 🔍 验证步骤

### 1. 检查控制台输出
运行游戏后，查看Godot控制台，应该看到：

```
========== 房间系统调试信息 ==========
✓ RoomManager已找到
  - 房间数量: 21
  - 当前房间: 0
  - 房间类型: 普通
✓ ExperienceManager已找到
  - 当前転流: 0
✓ EnemySpawner已找到
  - 使用房间系统: true
✓ GameUI已找到
  - 房间地图Canvas已创建
  - 転流标签已创建: 転流: 0
======================================
```

### 2. 检查UI显示
游戏运行时应该看到：

**左上角（从上到下）：**
- [ ] 红色血条
- [ ] 蓝色经验条
- [ ] 等级显示 "Lv.1"
- [ ] 金币显示 "金币: 0"
- [ ] 元素附魔面板（如果有附魔）
- [ ] 房间信息面板 "房间 1 - 普通" + "击杀 0/20"
- [ ] **転流显示 "転流: 0"** （橙色）⭐

**右上角：**
- [ ] **房间地图小地图** ⭐
  - 黑色背景面板
  - 标题"房间地图"
  - 显示21个房间的网络结构
  - 当前房间有黄色高亮圆圈

**右下角：**
- [ ] DPS统计面板

### 3. 检查游戏功能

**P点掉落：**
- [ ] 击败敌人后掉落P点图标（白色发光球）
- [ ] P点会飞向玩家

**転流系统：**
- [ ] 击败一个敌人后，転流+1
- [ ] 左上角"転流"数字增加

**房间进度：**
- [ ] 击败敌人后"击杀 X/20"数字增加
- [ ] 击败20个敌人后显示"房间清理完成!"
- [ ] 地图上出现多个传送门（根据房间连接数量）

**房间地图：**
- [ ] 右上角显示房间网络
- [ ] 当前房间有黄色圈
- [ ] 已访问房间颜色变暗
- [ ] 不同类型房间颜色不同：
  - 灰色 = 普通
  - 绿色 = 商店
  - 红色 = Boss
  - 紫色 = 附魔
  - 橙色 = 宝箱

**附魔房间：**
- [ ] 进入附魔房间看到紫色祭坛
- [ ] 靠近显示"按 E 购买附魔"
- [ ] 按E键打开商店界面
- [ ] 商店显示当前転流余额
- [ ] 可以花费転流购买6种附魔

**Boss房间：**
- [ ] 进入Boss房间前显示对话气泡
- [ ] 对话内容根据到达时间不同：
  - 5分钟内：辉夜的台词
  - 8分钟内：妖梦的台词
  - 10分钟后：琪露诺的台词

---

## ❌ 如果还是看不到效果

### 可能原因1：脚本没有重新加载
**解决方案：**
```bash
# 完全关闭Godot
# 删除.godot文件夹（隐藏文件夹）
# 重新打开项目
```

### 可能原因2：有编译错误
**解决方案：**
1. 查看Godot控制台的错误信息（红色文字）
2. 检查是否有脚本语法错误
3. 检查DebugChecker的输出，看哪个组件缺失

### 可能原因3：场景没有正确配置
**解决方案：**
1. 打开 `world.tscn`
2. 确认场景树中有以下节点：
   - ExperienceManager（脚本：ExperienceManager.gd）
   - EnemySpawner（脚本：EnemySpawner.gd，use_room_system=true）
   - RoomManager（脚本：RoomManager.gd）
   - GameUI（实例：GameUI.tscn）
   - DebugChecker（脚本：DebugChecker.gd）

### 可能原因4：UID冲突
**解决方案：**
1. 删除所有 `.import` 文件
2. 让Godot重新导入资源

---

## 🆘 紧急调试

如果以上都不行，检查以下内容并反馈：

1. **控制台输出**：复制DebugChecker的完整输出
2. **错误信息**：复制所有红色错误信息
3. **Godot版本**：确认使用Godot 4.x
4. **场景检查**：截图world场景的节点树
